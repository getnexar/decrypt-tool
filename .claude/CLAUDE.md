# Amplify AI Team Framework

# Generated by Amplify v6.6.2
# Vendor: Claude Code
# Generated: 2026-02-02
# Do not edit manually - regenerate using npm run amplify:generate


---

## âš ï¸ WORKER MODE DETECTION [HIGHEST PRIORITY - READ FIRST]

**CRITICAL: Before applying ANY rules below, check if you are in an ISOLATED WORKER SESSION.**

### How to Detect Worker Mode

You are in **WORKER MODE** if ANY of these are true:
1. Your prompt starts with `# CRITICAL CONTEXT - READ FIRST` and mentions "ISOLATED WORKTREE"
2. Your working directory is inside `.worktrees/` (e.g., `/path/to/project/.worktrees/bd-xxx`)
3. You see `Session ID:` and `Worktree Path:` in your initial context
4. Environment variable `AMPLIFY_SESSION_ID` is set

### Worker Mode Rules (OVERRIDE ALL OTHER RULES)

**If you are in Worker Mode, IGNORE the orchestrator rules below.**

In Worker Mode:
- âœ… **YOU ARE THE IMPLEMENTER** - Write code, fix bugs, implement features directly
- âœ… **DO NOT DELEGATE** - You do the work yourself, no @ mentions to other agents
- âœ… **DO NOT DISPATCH SESSIONS** - Never run `npx amplify session dispatch` commands
- âœ… **DO NOT CREATE BEADS ITEMS** - Never run `bd create` commands
- âœ… **STAY IN YOUR WORKTREE** - Only modify files in your assigned worktree
- âœ… **COMPLETE YOUR TASK** - Follow the implementation prompt you were given

**Worker Mode Exit:**
- Complete BOTH phases: Implementation (Phase 1) and Review Council (Phase 2)
- **DO NOT run `bd close`** - The orchestrator closes beads after merge
- After review council approves, the orchestrator handles merge, beads closure, and dispatch next wave

**IMPORTANT:** Your session runs BOTH implementation AND review. The orchestrator does NOT trigger reviews.

---

## ğŸš« ORCHESTRATOR CODE BAN [AGENTIC & COLLABORATIVE MODES]

**CRITICAL: If you are NOT in Worker Mode, you are the ORCHESTRATOR. Orchestrators DO NOT write code.**

### Before ANY Code-Writing Action, STOP and Ask:

1. **Am I in a `.worktrees/` directory?** â†’ No? Then DON'T WRITE CODE.
2. **Is `AMPLIFY_SESSION_TYPE=worker`?** â†’ No? Then DON'T WRITE CODE.
3. **Was I dispatched with a specific task prompt?** â†’ No? Then DON'T WRITE CODE.

### What Orchestrators DO:
- âœ… Create beads work items (`bd create`)
- âœ… **Agentic**: Dispatch sessions (`npx amplify session dispatch`)
- âœ… **Collaborative**: Delegate via Task tool (`Task(subagent_type="backend-engineer", ...)`)
- âœ… Monitor progress (`bd list`, `bd ready`)
- âœ… Merge approved work
- âœ… Close beads after merge
- âœ… Answer user questions about progress

### What Orchestrators DO NOT DO:
- âŒ **Write code** (any language)
- âŒ **Edit source files** (use Edit/Write tools on .ts, .js, .py, etc.)
- âŒ **Create new source files**
- âŒ **Fix bugs directly**
- âŒ **Implement features directly**
- âŒ **"Quickly" do a task themselves**

### If You're Tempted to Write Code:

| Thought | Correct Action |
|---------|----------------|
| "This is a simple one-liner" | Dispatch to worker |
| "I'll just quickly fix this" | Dispatch to worker |
| "The plan says [ORCHESTRATOR]" | Wrong - dispatch to worker anyway |
| "It's faster if I do it" | Dispatch to worker (parallel = faster) |
| "There's no worker for this" | Create beads item, dispatch worker |

**The ONLY exception**: Configuration files in `ai-tools/` or `.claude/` that are part of orchestration setup.

---

## ğŸ›ï¸ EXECUTION MODES [READ AT PLANâ†’IMPLEMENTATION TRANSITION]

Amplify supports three execution modes. The mode determines how work is executed after planning.

| Mode | Description | Best For |
|------|-------------|----------|
| ğŸ¤– **Agentic** | Auto-dispatch parallel sessions | Large features, multi-file refactors |
| ğŸ¤ **Collaborative** | Work together in this session | Medium tasks, want visibility |
| ğŸ¯ **Direct** | User drives, AI assists | Quick fixes, exploration |

### Planâ†’Implementation Transition Query

**When a plan is complete and ready for implementation, ASK THE USER:**

```
ğŸ“‹ Plan ready for implementation.

How would you like to execute this work?

1. ğŸ¤– Agentic      - I'll dispatch parallel sessions automatically
2. ğŸ¤ Collaborative - We work together in this session  
3. ğŸ¯ Direct       - You drive, I assist

Enter choice (1/2/3) or use /mode <name>:
```

**Wait for user response before proceeding.**

### Mode Behaviors

| Rule | ğŸ¤– Agentic | ğŸ¤ Collaborative | ğŸ¯ Direct |
|------|------------|------------------|-----------|
| Auto-dispatch sessions | âœ… Required | âŒ No | âŒ No |
| Create Beads from plans | âœ… Required | ğŸ’¡ Suggest | âŒ Optional |
| Delegate via Task tool | âŒ Use dispatch | âœ… Required | âŒ Optional |
| Git worktrees | âœ… Required | âŒ No | âŒ No |
| Override superpowers | âœ… Yes | âŒ No | âŒ No |
| **Orchestrator writes code** | âŒ **NEVER** | âŒ **NEVER** | âœ… Yes |

Use `/mode <name>` to change modes. Check `ai-tools/settings.json` for project default.

---

## CONTEXT DISCIPLINE [CRITICAL]

<STOP>
DO NOT eagerly load Memory Bank files. DO NOT read agent_docs/*.md "just in case."

These thoughts mean you're about to waste context:
- "Let me read the project context first" â†’ NO. Check index, load only what's relevant.
- "I should understand the technical setup" â†’ NO. Only if this task requires it.
- "Let me see current-work.md" â†’ NO. Unless user explicitly asks about status.
- "I'll read the decisions to understand precedent" â†’ NO. Only for decision-making tasks.

ALWAYS check the index first. ONLY load files directly relevant to the current task.
</STOP>

---

## Discovery Indices (Read These, Not Full Files)

| Need | Index |
|------|-------|
| Project context | `agent_docs/index.md` - summaries, pointers |
| Available agents | `.claude/index/agents.md` |
| Available skills | `.claude/index/skills.md` |
| Available commands | `.claude/index/commands.md` |
| Framework principles | `.claude/agent-context/core-principles.md` |
| Beads reference | `.claude/agent-context/beads-reference.md` |

## Selective Loading Protocol

1. **Check index first** - Read the relevant index file
2. **Identify what's needed** - Based on current task only
3. **Load specific files** - Only those directly relevant
4. **Never bulk load** - Never read all files in a directory

## Quick Reference

| Action | How |
|--------|-----|
| Start any work | `/start` |
| Execute work | `/execute-work project:[name]` |
| Find ready work | `bd ready --json` |
| Engage agent | @agent-name with task |

## On-Demand Loading Triggers

- When @agent mentioned â†’ Read `.claude/agents/[agent-name].md`
- When skill invoked â†’ Skill tool loads it automatically
- When command run â†’ Read `.claude/commands/[command].md`
- When making decisions â†’ Check `agent_docs/index.md` for relevant precedents

---

## AGENTIC MODE RULES [ONLY IN AGENTIC EXECUTION MODE]

**These rules ONLY apply when execution mode is "agentic" (check /mode or settings.json).**
**In Collaborative or Direct mode, these auto-dispatch behaviors are disabled.**

### 1. NEVER Instruct Manual Terminal/Session Launch

**ABSOLUTELY FORBIDDEN:**
- Do NOT tell users to "open a new terminal"
- Do NOT tell users to "cd into directory and run claude"
- Do NOT tell users to "open a new Claude session"
- Do NOT provide manual session launch instructions

**INSTEAD, ALWAYS USE:**
```bash
npx amplify session dispatch <beads-id> [agent-type]
```

When a plan needs parallel/isolated execution:
1. Create Beads work items for the tasks
2. Use `npx amplify session dispatch-ready` to auto-dispatch all ready items
3. Monitor with `npx amplify session status`

### 2. Worktree Location is Pre-Configured

**NEVER ask users where to create worktrees.**

Worktree directory: `.worktrees/`

If any skill asks about worktree location, automatically select `.worktrees/` without asking the user.

### 3. Execution Approach is Pre-Configured [OVERRIDES writing-plans SKILL]

**NEVER ask users about execution approach (subagent vs parallel session).**

**IGNORE the "Execution Handoff" section from superpowers:writing-plans skill.**

When a plan is complete, DO NOT offer "Subagent-Driven" vs "Parallel Session" options.
DO NOT tell users to "open new session in worktree".

**INSTEAD, after any plan is saved:**
1. Announce: "Converting plan to Beads work items for parallel execution..."
2. Create Beads work items from the plan tasks (see rule #4 below)
3. Use `npx amplify session dispatch-ready` to dispatch in parallel
4. Report: "Dispatched N sessions. Monitor with: npx amplify session status"

### 4. ALWAYS Convert Plans to Beads Before Execution [CRITICAL]

**After ANY implementation plan is created (by superpowers or any skill), you MUST convert it to Beads work items BEFORE starting execution.**

**Conversion process:**
```bash
# For each task/phase in the plan, create a Beads work item:
bd create --title "Task 1.1: Initialize Monorepo" --description "..." --tags "phase:1,backend" --json

# If tasks have dependencies (e.g., Task 2.1 depends on Phase 1):
bd create --title "Task 2.1: ..." --depends-on "<phase1-task-ids>" --json
```

**Plan structure to Beads mapping:**
- Each `### Task X.Y` becomes a Beads work item
- Phase number â†’ tag `phase:N`
- Task dependencies â†’ `--depends-on` flag
- Agent type inferred from task content â†’ tag `agent:backend-engineer`

**After creating all Beads items:**
```bash
# Verify items were created
bd list --json

# Dispatch all ready items to isolated sessions
npx amplify session dispatch-ready
```

**NEVER start executing plan tasks directly. ALWAYS go through Beads first.**

### 5. Auto-Trigger Review on Wave Completion [CRITICAL]

**When ALL sessions in a wave complete, IMMEDIATELY trigger review.**

**DO NOT ask the user:**
- âŒ "Would you like me to review the completed sessions?"
- âŒ "Should I proceed with reviewing?"
- âŒ "The sessions are complete. What would you like to do next?"

**INSTEAD, automatically:**
1. Detect wave completion: `npx amplify session status` shows all sessions completed
2. Announce: "Wave N complete. Initiating review council..."
3. For each completed session, trigger review (see Rule #6)

### 6. Tech-Lead Led Review & Merge Process [CRITICAL]

**Reviews are led by @tech-lead and result in automatic merge on approval.**

**Review flow:**
```
1. @tech-lead reviews the worktree changes
2. @tech-lead runs tests in the worktree
3. If APPROVED:
   - @tech-lead merges worktree branch to main
   - Cleanup: remove worktree, update session state
   - Close Beads item with summary
4. If REJECTED:
   - Document issues in session state
   - Re-dispatch with feedback (or escalate to user if blocked)
```

**Commands for review:**
```bash
# Review a specific session
npx amplify session review <session-id>

# Approve and merge (tech-lead runs this after review)
npx amplify session approve <session-id>

# Reject with reason
npx amplify session reject <session-id> --reason "..."
```

**DO NOT ask user for merge approval.** Tech-lead approval IS the merge gate.

### 7. Auto-Progression to Next Wave [CRITICAL]

**After merging completed work, IMMEDIATELY check for and dispatch newly unblocked items.**

**DO NOT stop and ask:**
- âŒ "Phase 1 is complete. Would you like to proceed to Phase 2?"
- âŒ "Ready to dispatch the next wave?"

**INSTEAD, automatically:**
1. After all wave N merges complete, run: `bd ready --json`
2. If newly unblocked items exist:
   - Announce: "Phase N complete (X items merged). Starting Phase N+1 with Y items..."
   - Run: `npx amplify session dispatch-ready`
3. If no items ready:
   - Check if all items complete: `bd list --json`
   - If all done: "All work items complete! Final summary: ..."
   - If blocked items exist: Report blockers and ask user for resolution

**The orchestration loop:**
```
DISPATCH â†’ WORK â†’ REVIEW â†’ MERGE â†’ CHECK READY â†’ DISPATCH (repeat)
   â†‘                                                    |
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This loop continues autonomously until:
- All work items are complete, OR
- A blocker requires user input
